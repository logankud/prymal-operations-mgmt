<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Raw Material</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
</head>

    

<body>
    <h1>Add Raw Material</h1>

    <!-- Add Raw Material Form -->
    <form method="POST" action="{{ url_for('add_raw_material') }}">
        <!-- Raw Material Name -->
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        <br><br>

        <!-- Vendor Dropdown -->
        <label for="vendor_id">Vendor:</label>
        <select id="vendor_id" name="vendor_id" required>
            <option value="">-- Select Vendor --</option>
            {% for vendor in vendors %}
                <option value="{{ vendor[0] }}">{{ vendor[1] }}</option>
            {% endfor %}
        </select>
        <br><br>

        <!-- Unit of Measure Dropdown -->
        <label for="unit_of_measure_id">Unit of Measure:</label>
        <select id="unit_of_measure_id" name="unit_of_measure_id" required>
            <option value="">-- Select Unit of Measure --</option>
            {% for uom in unit_of_measure %}
                <option value="{{ uom[0] }}">{{ uom[1] }} ({{ uom[2] }})</option>
            {% endfor %}
        </select>
        <br><br>

        <!-- Minimum Order Quantity (MOQ) -->
        <label for="moq">MOQ (Minimum Order Quantity):</label>
        <input type="number" id="moq" name="moq" min="0" step="0.01" required>
        <br><br>

        <!-- Tags -->
        <label for="tags">Tags:</label>
        <input id="tags" name="tags" value="{{ raw_material.tags | join(', ') if raw_material else '' }}" placeholder="Add tags..." required>
        <small>Start typing to see suggestions or add new tags.</small>
        <br><br>

        <!-- Submit Button -->
        <button type="submit">Add Raw Material</button>
        <a href="{{ url_for('raw_materials') }}">
            <button type="button">Cancel</button>
        </a>
    </form>

    <script>
        // Tagify initialization
        const tagInput = document.querySelector('#tags');
        const tagify = new Tagify(tagInput, {
            whitelist: [], // Will be dynamically populated
            dropdown: {
                enabled: 1, // Suggest tags after 1 character
            },
        });

        // Fetch existing tags from the server
        fetch("{{ url_for('fetch_tags') }}")
            .then((res) => res.json())
            .then((tags) => tagify.settings.whitelist = tags.map(tag => tag.name));
    </script>
    
</body>
</html>